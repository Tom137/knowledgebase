## 数据库锁
### 概要
#### 定义
#### 锁的分类
#### 锁升级
#### 锁与事务

#### 1. 定义

解决并发情况下的数据不一致等问题


#### 2. 锁的分类

按操作划分：DML锁， DDL锁  
按粒度划分：数据库锁，表锁，页锁，key-range,行锁，元数据锁  
按模式划分：共享锁，排他锁 ，更新锁，意向锁，架构锁   
按业务华分：悲观所，乐观锁

#### 2.1.1 DML锁  

常用的数据改动所加的锁

#### 2.1.2 DDL锁  

用于更改/创建表、视图和索引。对应架构锁

___


#### 2.2.1 数据库锁

无论何时当一个SQL Server 进程正在使用除master以外的数据库时，Lock Manager为该进程授予数据库级的锁。数据库级的锁总是共享锁，用于跟踪何时数据库在使用中，以防其他进程删除该数据库，将数据库置为脱机，或者恢复数据库

#### 2.2.2 表锁

对应整张表，包括所有数据和索引

#### 2.2.3 页锁

包括书库页和索引页

#### 2.2.4 key-range

对应索引页的一个范围

#### 2.2.5 行锁

对应表中一行数据

#### 2.2.6 元数据锁

数据库中的系统信息，例如 objectId

___

#### 2.3.1 共享锁
一般来说读操作会加共享锁。与共享锁、更新锁兼容。与排它锁冲突。共享锁在读操作结束时会立即释放，除非隔离级别较高（重复读及以上）

#### 2.3.2 排它锁
DML操作

#### 2.3.3 更新锁
一般来说读操作会加共享锁。与共享锁、更新锁兼容。与排它锁冲突

#### 2.3.4 意向锁（IS,IU,IX,SIU,SIX）
在低级别资源上加锁之前，通常在高级别的资源上加意向锁。比如在行上加共享锁之前，会在表和行上加意向共享锁。
主要作用是提高效率。

#### 2.3.4 架构锁（Sch-M,Sch-S）

所有的DDL都会加架构更新锁。例如修改表结构时，表上会加架构更新锁并阻塞所有对表的访问。

___


#### 2.4.1 悲观锁

认为拿到的数据总是会被更新，所以取数据的时候加上排它锁。

#### 2.4.2 悲观锁

认为拿到的数据不会被更新，不手动加锁。在更新时比较与数据库版本。

#### 3. 锁升级

#### 4. 锁与事务

事务是一系列数据库操作作为逻辑执行单元，事务的隔离级别就是对锁及锁的有效期的控制。



##### https://technet.microsoft.com/en-us/library/jj856598(v=sql.110).aspx

##### https://technet.microsoft.com/en-us/library/ms172975(v=sql.110).aspx
